<script>

function js_toggle_visibility() {
    var element = document.getElementById("option_buttons");
    var currentVisibility = getComputedStyle(element).visibility;

    console.log("Element:", currentVisibility);
    if (currentVisibility === "collapse") {
        element.style.visibility = "visible";
        element.style.display = "flex";
    } 
    else if (currentVisibility === "visible") {
        element.style.visibility = "collapse";
        element.style.display = "none";
    }
    else {
        element.style.visibility = "collapse";
        element.style.display = "none";
    }
}

function js_autoscroll_by_id(error_info) {
    const id_holder = error_info[0];
    const error_start = error_info[1];
    const error_end = error_info[2];
    console.log("Searching for id:", id_holder);
    const element = document.getElementById(id_holder);
    if (element) {
        console.log("Found id:", id_holder);
        const anchors = document.querySelectorAll('#transcript_id a');
        anchors.forEach(anchor => {
            anchor.style.backgroundColor = 'transparent';
        });
        
        // cross out the error in the sentence
        text = element.textContent;
        console.log("Text of error element: ", text);
        // index 13 is the first sentence character (avoiding speaker name
        const sentence_offset = 13;
        error_start += sentence_offset;
        error_end += sentence_offset;
        var start = text.slice(0, error_start);  // 
        var middle = text.slice(error_start, error_end); // The last character is not included, the first character is included
        var end = text.slice(error_end);

        // Wrap the middle text with a span and apply a strikethrough style
        var crossedOutMiddle = `<span style="text-decoration: line-through;">${middle}</span>`;

        // Recombine the text with the crossed out middle part
        element.innerHTML = start + crossedOutMiddle + end;

        // highlight the selected sentence with error
        //element.scrollIntoView({behavior: 'smooth'}); // doesn't work in Chrome 126.0.6478.126
        element.scrollIntoView({block: 'center'}); 
        element.animate([{ backgroundColor: 'darkred' }, { backgroundColor: 'transparent' }], { duration: 1000, iterations: 1 }); 
        element.style.backgroundColor = 'darkred';
    } 
    else { 
        console.log('Element not found for:', id_holder); 
    }
}

function js_autoscroll_by_value(word_to_search) {
    try {
        console.log("Searching for:", word_to_search);
        const anchors = document.querySelectorAll('#transcript_id a');
        let found = false;
        anchors.forEach(anchor => {
            if (anchor.textContent.includes(word_to_search)) {
                anchor.scrollIntoView({behavior: 'smooth', block: 'center'});
                anchor.animate([
                    { backgroundColor: 'yellow' },
                    { backgroundColor: 'transparent' }
                ], {
                    duration: 2000,
                    iterations: 1
                });
                found = true;
            }
        });
        if (!found) {
            console.log('Element not found for:', word_to_search);
        }
    } catch (error) {
        console.error("Error in autoscroll_to_string:", error);
    }
}

function js_refresh_page(dummy_param) {
    location.reload();

    return dummy_param;
}

</script>